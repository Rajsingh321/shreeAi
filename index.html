// ============================================================
// VIDEO FUNCTIONALITY - Click to Play/Pause
// ============================================================

document.addEventListener('DOMContentLoaded', function () {
    const serviceCards = document.querySelectorAll('.service-card');

    serviceCards.forEach(card => {
        const video = card.querySelector('.service-video');
        const videoWrapper = card.querySelector('.service-video-wrapper');
        const playBtn = card.querySelector('.video-play-btn');
        const overlay = card.querySelector('.video-overlay');
        
        // Remove sound button completely
        const soundBtn = card.querySelector('.video-sound-btn');
        if (soundBtn) {
            soundBtn.remove();
        }

        // Auto-play videos on load (muted for autoplay policy)
        const playPromise = video.play();
        if (playPromise !== undefined) {
            playPromise.catch(error => {
                console.log('Autoplay prevented:', error);
                overlay.classList.add('visible');
            });
        }

        // Update play button icon based on video state
        function updatePlayButton() {
            if (video.paused) {
                overlay.classList.add('visible');
                playBtn.innerHTML = `
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z" />
                    </svg>
                `;
            } else {
                overlay.classList.remove('visible');
                playBtn.innerHTML = `
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z" />
                    </svg>
                `;
            }
        }

        // Click on video wrapper to toggle play/pause
        videoWrapper.addEventListener('click', function(e) {
            // Don't trigger if clicking on service button
            if (e.target.closest('.btn-service')) return;
            
            if (video.paused) {
                video.play();
            } else {
                video.pause();
            }
            updatePlayButton();
        });

        // Show overlay on hover when video is playing
        videoWrapper.addEventListener('mouseenter', function() {
            if (!video.paused) {
                overlay.classList.add('visible');
            }
        });

        videoWrapper.addEventListener('mouseleave', function() {
            if (!video.paused) {
                overlay.classList.remove('visible');
            }
        });

        // Update button when video ends (for non-looping videos)
        video.addEventListener('ended', updatePlayButton);
        
        // Initialize button state
        updatePlayButton();
    });
});

// ============================================================
// MODAL FUNCTIONALITY
// ============================================================

// Sign Up Modal
const signupBtn = document.getElementById('signupBtn');
const signupModal = document.getElementById('signupModal');
const signupModalClose = document.getElementById('signupModalClose');
const signupForm = document.getElementById('signupForm');
const getCodeBtn = document.getElementById('getCodeBtn');
const verificationCode = document.getElementById('verificationCode');
const codeSentMsg = document.getElementById('codeSentMsg');
const signupSubmitBtn = document.getElementById('signupSubmitBtn');

// Booking Modal
const bookingModal = document.getElementById('bookingModal');
const bookingModalClose = document.getElementById('bookingModalClose');
const bookingForm = document.getElementById('bookingForm');
const serviceButtons = document.querySelectorAll('.btn-service');

// Success Modal
const successModal = document.getElementById('successModal');
const successBtn = document.getElementById('successBtn');

// Profile Menu
const profileMenu = document.getElementById('profileMenu');
const logoBtn = document.getElementById('logoBtn');

// Open Sign Up Modal
signupBtn?.addEventListener('click', () => {
    signupModal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
});

// Close Sign Up Modal
signupModalClose?.addEventListener('click', () => {
    signupModal.style.display = 'none';
    document.body.style.overflow = 'auto';
});

// Get Verification Code
getCodeBtn?.addEventListener('click', () => {
    const email = document.getElementById('signupEmail').value;
    if (!email || !email.includes('@')) {
        alert('Please enter a valid email address first');
        return;
    }

    // Simulate sending code
    getCodeBtn.disabled = true;
    getCodeBtn.textContent = 'Sending...';

    setTimeout(() => {
        verificationCode.disabled = false;
        signupSubmitBtn.disabled = false;
        codeSentMsg.style.display = 'block';
        getCodeBtn.textContent = 'Code Sent âœ“';
        getCodeBtn.style.backgroundColor = '#10B981';
    }, 1500);
});

// Handle Sign Up Form Submission
signupForm?.addEventListener('submit', (e) => {
    e.preventDefault();

    const name = document.getElementById('signupName').value;
    const email = document.getElementById('signupEmail').value;
    const code = document.getElementById('verificationCode').value;

    if (code.length !== 6) {
        alert('Please enter a valid 6-digit verification code');
        return;
    }

    // Store user data (in real app, this would be server-side)
    localStorage.setItem('userName', name);
    localStorage.setItem('userEmail', email);

    // Update UI
    signupBtn.style.display = 'none';
    profileMenu.style.display = 'block';
    document.getElementById('profileName').textContent = name.split(' ')[0];
    document.getElementById('profileInitial').textContent = name.charAt(0).toUpperCase();

    // Close modal
    signupModal.style.display = 'none';
    document.body.style.overflow = 'auto';

    // Reset form
    signupForm.reset();
    verificationCode.disabled = true;
    signupSubmitBtn.disabled = true;
    getCodeBtn.disabled = false;
    getCodeBtn.textContent = 'Get Code';
    getCodeBtn.style.backgroundColor = '';
    codeSentMsg.style.display = 'none';
});

// Open Booking Modal from Service Buttons
serviceButtons.forEach(btn => {
    btn.addEventListener('click', (e) => {
        const serviceName = btn.getAttribute('data-service');
        bookingModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';

        // Pre-check the corresponding service checkbox
        const checkboxes = document.querySelectorAll('input[name="services"]');
        checkboxes.forEach(checkbox => {
            if (checkbox.value === serviceName) {
                checkbox.checked = true;
            }
        });
    });
});

// Close Booking Modal
bookingModalClose?.addEventListener('click', () => {
    bookingModal.style.display = 'none';
    document.body.style.overflow = 'auto';
});

// Set minimum date to today for booking
const meetingDate = document.getElementById('meetingDate');
if (meetingDate) {
    const today = new Date().toISOString().split('T')[0];
    meetingDate.setAttribute('min', today);

    // Only allow weekends
    meetingDate.addEventListener('input', function () {
        const date = new Date(this.value);
        const day = date.getDay();
        if (day !== 0 && day !== 6) {
            alert('Please select a weekend date (Saturday or Sunday)');
            this.value = '';
        }
    });
}

// Handle Booking Form Submission
bookingForm?.addEventListener('submit', (e) => {
    e.preventDefault();

    // Validate at least one service is selected
    const selectedServices = document.querySelectorAll('input[name="services"]:checked');
    if (selectedServices.length === 0) {
        alert('Please select at least one service');
        return;
    }

    // Close booking modal
    bookingModal.style.display = 'none';

    // Show success modal
    successModal.style.display = 'flex';

    // Reset form
    bookingForm.reset();
});

// Close Success Modal
successBtn?.addEventListener('click', () => {
    successModal.style.display = 'none';
    document.body.style.overflow = 'auto';
});

// Close modals on overlay click
[signupModal, bookingModal, successModal].forEach(modal => {
    modal?.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    });
});

// Logo click - scroll to top
logoBtn?.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
});

// Check if user is already logged in
window.addEventListener('DOMContentLoaded', () => {
    const userName = localStorage.getItem('userName');
    if (userName) {
        signupBtn.style.display = 'none';
        profileMenu.style.display = 'block';
        document.getElementById('profileName').textContent = userName.split(' ')[0];
        document.getElementById('profileInitial').textContent = userName.charAt(0).toUpperCase();
    }
});
